ec9b6a4cbab5b7622b54776881afb8aa
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  Object.defineProperty(o, k2, {
    enumerable: true,
    get: function get() {
      return m[k];
    }
  });
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});

var __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});

var __importStar = this && this.__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) {
    if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  }

  __setModuleDefault(result, mod);

  return result;
};

var __importDefault = this && this.__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

var code_frame_1 = require("@babel/code-frame");

var fs_1 = __importDefault(require("fs"));

var json5_1 = __importDefault(require("json5"));

var path_1 = __importDefault(require("path"));

var util_1 = require("util");

var write_file_atomic_1 = __importDefault(require("write-file-atomic"));

var JsonFileError_1 = __importStar(require("./JsonFileError"));

var writeFileAtomicAsync = util_1.promisify(write_file_atomic_1.default);
var DEFAULT_OPTIONS = {
  badJsonDefault: undefined,
  jsonParseErrorDefault: undefined,
  cantReadFileDefault: undefined,
  ensureDir: false,
  default: undefined,
  json5: false,
  space: 2,
  addNewLineAtEOF: true
};

var JsonFile = function () {
  function JsonFile(file) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    (0, _classCallCheck2.default)(this, JsonFile);
    this.file = file;
    this.options = options;
  }

  (0, _createClass2.default)(JsonFile, [{
    key: "read",
    value: function read(options) {
      return _read(this.file, this._getOptions(options));
    }
  }, {
    key: "readAsync",
    value: function readAsync(options) {
      return _regenerator.default.async(function readAsync$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              return _context.abrupt("return", _readAsync(this.file, this._getOptions(options)));

            case 1:
            case "end":
              return _context.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "writeAsync",
    value: function writeAsync(object, options) {
      return _regenerator.default.async(function writeAsync$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              return _context2.abrupt("return", _writeAsync(this.file, object, this._getOptions(options)));

            case 1:
            case "end":
              return _context2.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "parseJsonString",
    value: function parseJsonString(json, options) {
      return _parseJsonString(json, options);
    }
  }, {
    key: "getAsync",
    value: function getAsync(key, defaultValue, options) {
      return _regenerator.default.async(function getAsync$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              return _context3.abrupt("return", _getAsync(this.file, key, defaultValue, this._getOptions(options)));

            case 1:
            case "end":
              return _context3.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "setAsync",
    value: function setAsync(key, value, options) {
      return _regenerator.default.async(function setAsync$(_context4) {
        while (1) {
          switch (_context4.prev = _context4.next) {
            case 0:
              return _context4.abrupt("return", _setAsync(this.file, key, value, this._getOptions(options)));

            case 1:
            case "end":
              return _context4.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "mergeAsync",
    value: function mergeAsync(sources, options) {
      return _regenerator.default.async(function mergeAsync$(_context5) {
        while (1) {
          switch (_context5.prev = _context5.next) {
            case 0:
              return _context5.abrupt("return", _mergeAsync(this.file, sources, this._getOptions(options)));

            case 1:
            case "end":
              return _context5.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "deleteKeyAsync",
    value: function deleteKeyAsync(key, options) {
      return _regenerator.default.async(function deleteKeyAsync$(_context6) {
        while (1) {
          switch (_context6.prev = _context6.next) {
            case 0:
              return _context6.abrupt("return", _deleteKeyAsync(this.file, key, this._getOptions(options)));

            case 1:
            case "end":
              return _context6.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "deleteKeysAsync",
    value: function deleteKeysAsync(keys, options) {
      return _regenerator.default.async(function deleteKeysAsync$(_context7) {
        while (1) {
          switch (_context7.prev = _context7.next) {
            case 0:
              return _context7.abrupt("return", _deleteKeysAsync(this.file, keys, this._getOptions(options)));

            case 1:
            case "end":
              return _context7.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "rewriteAsync",
    value: function rewriteAsync(options) {
      return _regenerator.default.async(function rewriteAsync$(_context8) {
        while (1) {
          switch (_context8.prev = _context8.next) {
            case 0:
              return _context8.abrupt("return", _rewriteAsync(this.file, this._getOptions(options)));

            case 1:
            case "end":
              return _context8.stop();
          }
        }
      }, null, this, null, Promise);
    }
  }, {
    key: "_getOptions",
    value: function _getOptions(options) {
      return _objectSpread(_objectSpread({}, this.options), options);
    }
  }]);
  return JsonFile;
}();

exports.default = JsonFile;
JsonFile.read = _read;
JsonFile.readAsync = _readAsync;
JsonFile.parseJsonString = _parseJsonString;
JsonFile.writeAsync = _writeAsync;
JsonFile.getAsync = _getAsync;
JsonFile.setAsync = _setAsync;
JsonFile.mergeAsync = _mergeAsync;
JsonFile.deleteKeyAsync = _deleteKeyAsync;
JsonFile.deleteKeysAsync = _deleteKeysAsync;
JsonFile.rewriteAsync = _rewriteAsync;

function _read(file, options) {
  var json;

  try {
    json = fs_1.default.readFileSync(file, 'utf8');
  } catch (error) {
    assertEmptyJsonString(json, file);
    var defaultValue = cantReadFileDefault(options);

    if (defaultValue === undefined) {
      throw new JsonFileError_1.default("Can't read JSON file: " + file, error, error.code, file);
    } else {
      return defaultValue;
    }
  }

  return _parseJsonString(json, options, file);
}

function _readAsync(file, options) {
  var json, defaultValue;
  return _regenerator.default.async(function _readAsync$(_context9) {
    while (1) {
      switch (_context9.prev = _context9.next) {
        case 0:
          _context9.prev = 0;
          _context9.next = 3;
          return _regenerator.default.awrap(fs_1.default.promises.readFile(file, 'utf8'));

        case 3:
          json = _context9.sent;
          _context9.next = 15;
          break;

        case 6:
          _context9.prev = 6;
          _context9.t0 = _context9["catch"](0);
          assertEmptyJsonString(json, file);
          defaultValue = cantReadFileDefault(options);

          if (!(defaultValue === undefined)) {
            _context9.next = 14;
            break;
          }

          throw new JsonFileError_1.default("Can't read JSON file: " + file, _context9.t0, _context9.t0.code);

        case 14:
          return _context9.abrupt("return", defaultValue);

        case 15:
          return _context9.abrupt("return", _parseJsonString(json, options));

        case 16:
        case "end":
          return _context9.stop();
      }
    }
  }, null, null, [[0, 6]], Promise);
}

function _parseJsonString(json, options, fileName) {
  assertEmptyJsonString(json, fileName);

  try {
    if (_getOption(options, 'json5')) {
      return json5_1.default.parse(json);
    } else {
      return JSON.parse(json);
    }
  } catch (e) {
    var defaultValue = jsonParseErrorDefault(options);

    if (defaultValue === undefined) {
      var location = locationFromSyntaxError(e, json);

      if (location) {
        var codeFrame = code_frame_1.codeFrameColumns(json, {
          start: location
        });
        e.codeFrame = codeFrame;
        e.message += "\n" + codeFrame;
      }

      throw new JsonFileError_1.default("Error parsing JSON: " + json, e, 'EJSONPARSE', fileName);
    } else {
      return defaultValue;
    }
  }
}

function _getAsync(file, key, defaultValue, options) {
  var object;
  return _regenerator.default.async(function _getAsync$(_context10) {
    while (1) {
      switch (_context10.prev = _context10.next) {
        case 0:
          _context10.next = 2;
          return _regenerator.default.awrap(_readAsync(file, options));

        case 2:
          object = _context10.sent;

          if (!(key in object)) {
            _context10.next = 5;
            break;
          }

          return _context10.abrupt("return", object[key]);

        case 5:
          if (!(defaultValue === undefined)) {
            _context10.next = 7;
            break;
          }

          throw new JsonFileError_1.default("No value at key path \"" + key + "\" in JSON object from: " + file);

        case 7:
          return _context10.abrupt("return", defaultValue);

        case 8:
        case "end":
          return _context10.stop();
      }
    }
  }, null, null, null, Promise);
}

function _writeAsync(file, object, options) {
  var space, json5, addNewLineAtEOF, json, data;
  return _regenerator.default.async(function _writeAsync$(_context11) {
    while (1) {
      switch (_context11.prev = _context11.next) {
        case 0:
          if (!(options === null || options === void 0 ? void 0 : options.ensureDir)) {
            _context11.next = 3;
            break;
          }

          _context11.next = 3;
          return _regenerator.default.awrap(fs_1.default.promises.mkdir(path_1.default.dirname(file), {
            recursive: true
          }));

        case 3:
          space = _getOption(options, 'space');
          json5 = _getOption(options, 'json5');
          addNewLineAtEOF = _getOption(options, 'addNewLineAtEOF');
          _context11.prev = 6;

          if (json5) {
            json = json5_1.default.stringify(object, null, space);
          } else {
            json = JSON.stringify(object, null, space);
          }

          _context11.next = 13;
          break;

        case 10:
          _context11.prev = 10;
          _context11.t0 = _context11["catch"](6);
          throw new JsonFileError_1.default("Couldn't JSON.stringify object for file: " + file, _context11.t0);

        case 13:
          data = addNewLineAtEOF ? json + "\n" : json;
          _context11.next = 16;
          return _regenerator.default.awrap(writeFileAtomicAsync(file, data, {}));

        case 16:
          return _context11.abrupt("return", object);

        case 17:
        case "end":
          return _context11.stop();
      }
    }
  }, null, null, [[6, 10]], Promise);
}

function _setAsync(file, key, value, options) {
  var object;
  return _regenerator.default.async(function _setAsync$(_context12) {
    while (1) {
      switch (_context12.prev = _context12.next) {
        case 0:
          _context12.next = 2;
          return _regenerator.default.awrap(_readAsync(file, options));

        case 2:
          object = _context12.sent;
          return _context12.abrupt("return", _writeAsync(file, _objectSpread(_objectSpread({}, object), {}, (0, _defineProperty2.default)({}, key, value)), options));

        case 4:
        case "end":
          return _context12.stop();
      }
    }
  }, null, null, null, Promise);
}

function _mergeAsync(file, sources, options) {
  var object;
  return _regenerator.default.async(function _mergeAsync$(_context13) {
    while (1) {
      switch (_context13.prev = _context13.next) {
        case 0:
          _context13.next = 2;
          return _regenerator.default.awrap(_readAsync(file, options));

        case 2:
          object = _context13.sent;

          if (Array.isArray(sources)) {
            Object.assign.apply(Object, [object].concat((0, _toConsumableArray2.default)(sources)));
          } else {
            (0, _extends2.default)(object, sources);
          }

          return _context13.abrupt("return", _writeAsync(file, object, options));

        case 5:
        case "end":
          return _context13.stop();
      }
    }
  }, null, null, null, Promise);
}

function _deleteKeyAsync(file, key, options) {
  return _regenerator.default.async(function _deleteKeyAsync$(_context14) {
    while (1) {
      switch (_context14.prev = _context14.next) {
        case 0:
          return _context14.abrupt("return", _deleteKeysAsync(file, [key], options));

        case 1:
        case "end":
          return _context14.stop();
      }
    }
  }, null, null, null, Promise);
}

function _deleteKeysAsync(file, keys, options) {
  var object, didDelete, i, key;
  return _regenerator.default.async(function _deleteKeysAsync$(_context15) {
    while (1) {
      switch (_context15.prev = _context15.next) {
        case 0:
          _context15.next = 2;
          return _regenerator.default.awrap(_readAsync(file, options));

        case 2:
          object = _context15.sent;
          didDelete = false;

          for (i = 0; i < keys.length; i++) {
            key = keys[i];

            if (object.hasOwnProperty(key)) {
              delete object[key];
              didDelete = true;
            }
          }

          if (!didDelete) {
            _context15.next = 7;
            break;
          }

          return _context15.abrupt("return", _writeAsync(file, object, options));

        case 7:
          return _context15.abrupt("return", object);

        case 8:
        case "end":
          return _context15.stop();
      }
    }
  }, null, null, null, Promise);
}

function _rewriteAsync(file, options) {
  var object;
  return _regenerator.default.async(function _rewriteAsync$(_context16) {
    while (1) {
      switch (_context16.prev = _context16.next) {
        case 0:
          _context16.next = 2;
          return _regenerator.default.awrap(_readAsync(file, options));

        case 2:
          object = _context16.sent;
          return _context16.abrupt("return", _writeAsync(file, object, options));

        case 4:
        case "end":
          return _context16.stop();
      }
    }
  }, null, null, null, Promise);
}

function jsonParseErrorDefault() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  if (options.jsonParseErrorDefault === undefined) {
    return options.default;
  } else {
    return options.jsonParseErrorDefault;
  }
}

function cantReadFileDefault() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  if (options.cantReadFileDefault === undefined) {
    return options.default;
  } else {
    return options.cantReadFileDefault;
  }
}

function _getOption(options, field) {
  if (options) {
    if (options[field] !== undefined) {
      return options[field];
    }
  }

  return DEFAULT_OPTIONS[field];
}

function locationFromSyntaxError(error, sourceString) {
  if ('lineNumber' in error && 'columnNumber' in error) {
    return {
      line: error.lineNumber,
      column: error.columnNumber
    };
  }

  var match = /at position (\d+)/.exec(error.message);

  if (match) {
    var index = parseInt(match[1], 10);
    var lines = sourceString.slice(0, index + 1).split('\n');
    return {
      line: lines.length,
      column: lines[lines.length - 1].length
    };
  }

  return null;
}

function assertEmptyJsonString(json, file) {
  if ((json === null || json === void 0 ? void 0 : json.trim()) === '') {
    throw new JsonFileError_1.EmptyJsonFileError(file);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Kc29uRmlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxZQUFBLEdBQUEsT0FBQSxDQUFBLG1CQUFBLENBQUE7O0FBQ0EsSUFBQSxJQUFBLEdBQUEsZUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLE9BQUEsR0FBQSxlQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsTUFBQSxHQUFBLGVBQUEsQ0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLE1BQUEsQ0FBQTs7QUFDQSxJQUFBLG1CQUFBLEdBQUEsZUFBQSxDQUFBLE9BQUEsQ0FBQSxtQkFBQSxDQUFBLENBQUE7O0FBRUEsSUFBQSxlQUFBLEdBQUEsWUFBQSxDQUFBLE9BQUEsbUJBQUEsQ0FBQTs7QUFFQSxJQUFNLG9CQUFvQixHQUlkLE1BQUEsQ0FBQSxTQUFBLENBQVUsbUJBQUEsQ0FBQSxPQUFWLENBSlo7QUF5QkEsSUFBTSxlQUFlLEdBQUc7QUFDdEIsRUFBQSxjQUFjLEVBQUUsU0FETTtBQUV0QixFQUFBLHFCQUFxQixFQUFFLFNBRkQ7QUFHdEIsRUFBQSxtQkFBbUIsRUFBRSxTQUhDO0FBSXRCLEVBQUEsU0FBUyxFQUFFLEtBSlc7QUFLdEIsRUFBQSxPQUFPLEVBQUUsU0FMYTtBQU10QixFQUFBLEtBQUssRUFBRSxLQU5lO0FBT3RCLEVBQUEsS0FBSyxFQUFFLENBUGU7QUFRdEIsRUFBQSxlQUFlLEVBQUU7QUFSSyxDQUF4Qjs7SUFrQnFCLFE7QUFlbkIsb0JBQVksSUFBWixFQUE0RDtBQUFBLFFBQWxDLE9BQWtDLHVFQUFGLEVBQUU7QUFBQTtBQUMxRCxTQUFLLElBQUwsR0FBWSxJQUFaO0FBQ0EsU0FBSyxPQUFMLEdBQWUsT0FBZjtBQUNEOzs7O1dBRUQsY0FBSyxPQUFMLEVBQW1DO0FBQ2pDLGFBQU8sS0FBSSxDQUFDLEtBQUssSUFBTixFQUFZLEtBQUssV0FBTCxDQUFpQixPQUFqQixDQUFaLENBQVg7QUFDRDs7O1dBRUQsbUJBQWdCLE9BQWhCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSwrQ0FDUyxVQUFTLENBQUMsS0FBSyxJQUFOLEVBQVksS0FBSyxXQUFMLENBQWlCLE9BQWpCLENBQVosQ0FEbEI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztXQUlBLG9CQUFpQixNQUFqQixFQUFzQyxPQUF0QztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsZ0RBQ1MsV0FBVSxDQUFDLEtBQUssSUFBTixFQUFZLE1BQVosRUFBb0IsS0FBSyxXQUFMLENBQWlCLE9BQWpCLENBQXBCLENBRG5COztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7V0FJQSx5QkFBZ0IsSUFBaEIsRUFBOEIsT0FBOUIsRUFBNEQ7QUFDMUQsYUFBTyxnQkFBZSxDQUFDLElBQUQsRUFBTyxPQUFQLENBQXRCO0FBQ0Q7OztXQUVELGtCQUNFLEdBREYsRUFFRSxZQUZGLEVBR0UsT0FIRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsZ0RBS1MsU0FBUSxDQUFDLEtBQUssSUFBTixFQUFZLEdBQVosRUFBaUIsWUFBakIsRUFBK0IsS0FBSyxXQUFMLENBQWlCLE9BQWpCLENBQS9CLENBTGpCOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7V0FRQSxrQkFBZSxHQUFmLEVBQTRCLEtBQTVCLEVBQTRDLE9BQTVDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxnREFDUyxTQUFRLENBQUMsS0FBSyxJQUFOLEVBQVksR0FBWixFQUFpQixLQUFqQixFQUF3QixLQUFLLFdBQUwsQ0FBaUIsT0FBakIsQ0FBeEIsQ0FEakI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztXQUlBLG9CQUNFLE9BREYsRUFFRSxPQUZGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxnREFJUyxXQUFVLENBQWMsS0FBSyxJQUFuQixFQUF5QixPQUF6QixFQUFrQyxLQUFLLFdBQUwsQ0FBaUIsT0FBakIsQ0FBbEMsQ0FKbkI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztXQU9BLHdCQUFxQixHQUFyQixFQUFrQyxPQUFsQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsZ0RBQ1MsZUFBYyxDQUFDLEtBQUssSUFBTixFQUFZLEdBQVosRUFBaUIsS0FBSyxXQUFMLENBQWlCLE9BQWpCLENBQWpCLENBRHZCOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7V0FJQSx5QkFBc0IsSUFBdEIsRUFBc0MsT0FBdEM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGdEQUNTLGdCQUFlLENBQUMsS0FBSyxJQUFOLEVBQVksSUFBWixFQUFrQixLQUFLLFdBQUwsQ0FBaUIsT0FBakIsQ0FBbEIsQ0FEeEI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztXQUlBLHNCQUFtQixPQUFuQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsZ0RBQ1MsYUFBWSxDQUFDLEtBQUssSUFBTixFQUFZLEtBQUssV0FBTCxDQUFpQixPQUFqQixDQUFaLENBRHJCOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7V0FJQSxxQkFBWSxPQUFaLEVBQTBDO0FBQ3hDLDZDQUNLLEtBQUssT0FEVixHQUVLLE9BRkw7QUFJRDs7Ozs7QUF4RUgsT0FBQSxDQUFBLE9BQUEsR0FBQSxRQUFBO0FBSVMsUUFBQSxDQUFBLElBQUEsR0FBTyxLQUFQO0FBQ0EsUUFBQSxDQUFBLFNBQUEsR0FBWSxVQUFaO0FBQ0EsUUFBQSxDQUFBLGVBQUEsR0FBa0IsZ0JBQWxCO0FBQ0EsUUFBQSxDQUFBLFVBQUEsR0FBYSxXQUFiO0FBQ0EsUUFBQSxDQUFBLFFBQUEsR0FBVyxTQUFYO0FBQ0EsUUFBQSxDQUFBLFFBQUEsR0FBVyxTQUFYO0FBQ0EsUUFBQSxDQUFBLFVBQUEsR0FBYSxXQUFiO0FBQ0EsUUFBQSxDQUFBLGNBQUEsR0FBaUIsZUFBakI7QUFDQSxRQUFBLENBQUEsZUFBQSxHQUFrQixnQkFBbEI7QUFDQSxRQUFBLENBQUEsWUFBQSxHQUFlLGFBQWY7O0FBOERULFNBQVMsS0FBVCxDQUNFLElBREYsRUFFRSxPQUZGLEVBRWdDO0FBRTlCLE1BQUksSUFBSjs7QUFDQSxNQUFJO0FBQ0YsSUFBQSxJQUFJLEdBQUcsSUFBQSxDQUFBLE9BQUEsQ0FBRyxZQUFILENBQWdCLElBQWhCLEVBQXNCLE1BQXRCLENBQVA7QUFDRCxHQUZELENBRUUsT0FBTyxLQUFQLEVBQWM7QUFDZCxJQUFBLHFCQUFxQixDQUFDLElBQUQsRUFBTyxJQUFQLENBQXJCO0FBQ0EsUUFBTSxZQUFZLEdBQUcsbUJBQW1CLENBQUMsT0FBRCxDQUF4Qzs7QUFDQSxRQUFJLFlBQVksS0FBSyxTQUFyQixFQUFnQztBQUM5QixZQUFNLElBQUksZUFBQSxDQUFBLE9BQUosNEJBQTJDLElBQTNDLEVBQW1ELEtBQW5ELEVBQTBELEtBQUssQ0FBQyxJQUFoRSxFQUFzRSxJQUF0RSxDQUFOO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsYUFBTyxZQUFQO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPLGdCQUFlLENBQUMsSUFBRCxFQUFPLE9BQVAsRUFBZ0IsSUFBaEIsQ0FBdEI7QUFDRDs7QUFFRCxTQUFlLFVBQWYsQ0FDRSxJQURGLEVBRUUsT0FGRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsNENBTWlCLElBQUEsQ0FBQSxPQUFBLENBQUcsUUFBSCxDQUFZLFFBQVosQ0FBcUIsSUFBckIsRUFBMkIsTUFBM0IsQ0FOakI7O0FBQUE7QUFNSSxVQUFBLElBTko7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQVFJLFVBQUEscUJBQXFCLENBQUMsSUFBRCxFQUFPLElBQVAsQ0FBckI7QUFDTSxVQUFBLFlBVFYsR0FTeUIsbUJBQW1CLENBQUMsT0FBRCxDQVQ1Qzs7QUFBQSxnQkFVUSxZQUFZLEtBQUssU0FWekI7QUFBQTtBQUFBO0FBQUE7O0FBQUEsZ0JBV1ksSUFBSSxlQUFBLENBQUEsT0FBSiw0QkFBMkMsSUFBM0MsZ0JBQTBELGFBQU0sSUFBaEUsQ0FYWjs7QUFBQTtBQUFBLDRDQWFhLFlBYmI7O0FBQUE7QUFBQSw0Q0FnQlMsZ0JBQWUsQ0FBQyxJQUFELEVBQU8sT0FBUCxDQWhCeEI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBbUJBLFNBQVMsZ0JBQVQsQ0FDRSxJQURGLEVBRUUsT0FGRixFQUdFLFFBSEYsRUFHbUI7QUFFakIsRUFBQSxxQkFBcUIsQ0FBQyxJQUFELEVBQU8sUUFBUCxDQUFyQjs7QUFDQSxNQUFJO0FBQ0YsUUFBSSxVQUFVLENBQUMsT0FBRCxFQUFVLE9BQVYsQ0FBZCxFQUFrQztBQUNoQyxhQUFPLE9BQUEsQ0FBQSxPQUFBLENBQU0sS0FBTixDQUFZLElBQVosQ0FBUDtBQUNELEtBRkQsTUFFTztBQUNMLGFBQU8sSUFBSSxDQUFDLEtBQUwsQ0FBVyxJQUFYLENBQVA7QUFDRDtBQUNGLEdBTkQsQ0FNRSxPQUFPLENBQVAsRUFBVTtBQUNWLFFBQU0sWUFBWSxHQUFHLHFCQUFxQixDQUFDLE9BQUQsQ0FBMUM7O0FBQ0EsUUFBSSxZQUFZLEtBQUssU0FBckIsRUFBZ0M7QUFDOUIsVUFBTSxRQUFRLEdBQUcsdUJBQXVCLENBQUMsQ0FBRCxFQUFJLElBQUosQ0FBeEM7O0FBQ0EsVUFBSSxRQUFKLEVBQWM7QUFDWixZQUFNLFNBQVMsR0FBRyxZQUFBLENBQUEsZ0JBQUEsQ0FBaUIsSUFBakIsRUFBdUI7QUFBRSxVQUFBLEtBQUssRUFBRTtBQUFULFNBQXZCLENBQWxCO0FBQ0EsUUFBQSxDQUFDLENBQUMsU0FBRixHQUFjLFNBQWQ7QUFDQSxRQUFBLENBQUMsQ0FBQyxPQUFGLFdBQWtCLFNBQWxCO0FBQ0Q7O0FBQ0QsWUFBTSxJQUFJLGVBQUEsQ0FBQSxPQUFKLDBCQUF5QyxJQUF6QyxFQUFpRCxDQUFqRCxFQUFvRCxZQUFwRCxFQUFrRSxRQUFsRSxDQUFOO0FBQ0QsS0FSRCxNQVFPO0FBQ0wsYUFBTyxZQUFQO0FBQ0Q7QUFDRjtBQUNGOztBQUVELFNBQWUsU0FBZixDQUNFLElBREYsRUFFRSxHQUZGLEVBR0UsWUFIRixFQUlFLE9BSkY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSw0Q0FNdUIsVUFBUyxDQUFDLElBQUQsRUFBTyxPQUFQLENBTmhDOztBQUFBO0FBTVEsVUFBQSxNQU5SOztBQUFBLGdCQU9NLEdBQUcsSUFBSSxNQVBiO0FBQUE7QUFBQTtBQUFBOztBQUFBLDZDQVFXLE1BQU0sQ0FBQyxHQUFELENBUmpCOztBQUFBO0FBQUEsZ0JBVU0sWUFBWSxLQUFLLFNBVnZCO0FBQUE7QUFBQTtBQUFBOztBQUFBLGdCQVdVLElBQUksZUFBQSxDQUFBLE9BQUosNkJBQTJDLEdBQTNDLGdDQUF3RSxJQUF4RSxDQVhWOztBQUFBO0FBQUEsNkNBYVMsWUFiVDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFnQkEsU0FBZSxXQUFmLENBQ0UsSUFERixFQUVFLE1BRkYsRUFHRSxPQUhGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGdCQUtNLE9BQU8sS0FBQSxJQUFQLElBQUEsT0FBTyxLQUFBLEtBQUEsQ0FBUCxHQUFPLEtBQUEsQ0FBUCxHQUFBLE9BQU8sQ0FBRSxTQUxmO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEsNENBTVUsSUFBQSxDQUFBLE9BQUEsQ0FBRyxRQUFILENBQVksS0FBWixDQUFrQixNQUFBLENBQUEsT0FBQSxDQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWxCLEVBQXNDO0FBQUUsWUFBQSxTQUFTLEVBQUU7QUFBYixXQUF0QyxDQU5WOztBQUFBO0FBUVEsVUFBQSxLQVJSLEdBUWdCLFVBQVUsQ0FBQyxPQUFELEVBQVUsT0FBVixDQVIxQjtBQVNRLFVBQUEsS0FUUixHQVNnQixVQUFVLENBQUMsT0FBRCxFQUFVLE9BQVYsQ0FUMUI7QUFVUSxVQUFBLGVBVlIsR0FVMEIsVUFBVSxDQUFDLE9BQUQsRUFBVSxpQkFBVixDQVZwQztBQUFBOztBQWFJLGNBQUksS0FBSixFQUFXO0FBQ1QsWUFBQSxJQUFJLEdBQUcsT0FBQSxDQUFBLE9BQUEsQ0FBTSxTQUFOLENBQWdCLE1BQWhCLEVBQXdCLElBQXhCLEVBQThCLEtBQTlCLENBQVA7QUFDRCxXQUZELE1BRU87QUFDTCxZQUFBLElBQUksR0FBRyxJQUFJLENBQUMsU0FBTCxDQUFlLE1BQWYsRUFBdUIsSUFBdkIsRUFBNkIsS0FBN0IsQ0FBUDtBQUNEOztBQWpCTDtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQUFBLGdCQW1CVSxJQUFJLGVBQUEsQ0FBQSxPQUFKLCtDQUE4RCxJQUE5RCxnQkFuQlY7O0FBQUE7QUFxQlEsVUFBQSxJQXJCUixHQXFCZSxlQUFlLEdBQU0sSUFBTixVQUFpQixJQXJCL0M7QUFBQTtBQUFBLDRDQXNCUSxvQkFBb0IsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLEVBQWIsQ0F0QjVCOztBQUFBO0FBQUEsNkNBdUJTLE1BdkJUOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQTBCQSxTQUFlLFNBQWYsQ0FDRSxJQURGLEVBRUUsR0FGRixFQUdFLEtBSEYsRUFJRSxPQUpGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsNENBUXVCLFVBQVMsQ0FBQyxJQUFELEVBQU8sT0FBUCxDQVJoQzs7QUFBQTtBQVFRLFVBQUEsTUFSUjtBQUFBLDZDQVNTLFdBQVUsQ0FBQyxJQUFELGtDQUFZLE1BQVoseUNBQXFCLEdBQXJCLEVBQTJCLEtBQTNCLElBQW9DLE9BQXBDLENBVG5COztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQVlBLFNBQWUsV0FBZixDQUNFLElBREYsRUFFRSxPQUZGLEVBR0UsT0FIRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDRDQUt1QixVQUFTLENBQUMsSUFBRCxFQUFPLE9BQVAsQ0FMaEM7O0FBQUE7QUFLUSxVQUFBLE1BTFI7O0FBTUUsY0FBSSxLQUFLLENBQUMsT0FBTixDQUFjLE9BQWQsQ0FBSixFQUE0QjtBQUMxQixZQUFBLE1BQU0sQ0FBQyxNQUFQLE9BQUEsTUFBTSxHQUFRLE1BQVIsMENBQW1CLE9BQW5CLEdBQU47QUFDRCxXQUZELE1BRU87QUFDTCxtQ0FBYyxNQUFkLEVBQXNCLE9BQXRCO0FBQ0Q7O0FBVkgsNkNBV1MsV0FBVSxDQUFDLElBQUQsRUFBTyxNQUFQLEVBQWUsT0FBZixDQVhuQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFjQSxTQUFlLGVBQWYsQ0FDRSxJQURGLEVBRUUsR0FGRixFQUdFLE9BSEY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDZDQUtTLGdCQUFlLENBQUMsSUFBRCxFQUFPLENBQUMsR0FBRCxDQUFQLEVBQWMsT0FBZCxDQUx4Qjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFRQSxTQUFlLGdCQUFmLENBQ0UsSUFERixFQUVFLElBRkYsRUFHRSxPQUhGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsNENBS3VCLFVBQVMsQ0FBQyxJQUFELEVBQU8sT0FBUCxDQUxoQzs7QUFBQTtBQUtRLFVBQUEsTUFMUjtBQU1NLFVBQUEsU0FOTixHQU1rQixLQU5sQjs7QUFRRSxlQUFTLENBQVQsR0FBYSxDQUFiLEVBQWdCLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBekIsRUFBaUMsQ0FBQyxFQUFsQyxFQUFzQztBQUM5QixZQUFBLEdBRDhCLEdBQ3hCLElBQUksQ0FBQyxDQUFELENBRG9COztBQUVwQyxnQkFBSSxNQUFNLENBQUMsY0FBUCxDQUFzQixHQUF0QixDQUFKLEVBQWdDO0FBQzlCLHFCQUFPLE1BQU0sQ0FBQyxHQUFELENBQWI7QUFDQSxjQUFBLFNBQVMsR0FBRyxJQUFaO0FBQ0Q7QUFDRjs7QUFkSCxlQWdCTSxTQWhCTjtBQUFBO0FBQUE7QUFBQTs7QUFBQSw2Q0FpQlcsV0FBVSxDQUFDLElBQUQsRUFBTyxNQUFQLEVBQWUsT0FBZixDQWpCckI7O0FBQUE7QUFBQSw2Q0FtQlMsTUFuQlQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBc0JBLFNBQWUsYUFBZixDQUNFLElBREYsRUFFRSxPQUZGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsNENBSXVCLFVBQVMsQ0FBQyxJQUFELEVBQU8sT0FBUCxDQUpoQzs7QUFBQTtBQUlRLFVBQUEsTUFKUjtBQUFBLDZDQUtTLFdBQVUsQ0FBQyxJQUFELEVBQU8sTUFBUCxFQUFlLE9BQWYsQ0FMbkI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBUUEsU0FBUyxxQkFBVCxHQUNvQztBQUFBLE1BQWxDLE9BQWtDLHVFQUFGLEVBQUU7O0FBRWxDLE1BQUksT0FBTyxDQUFDLHFCQUFSLEtBQWtDLFNBQXRDLEVBQWlEO0FBQy9DLFdBQU8sT0FBTyxDQUFDLE9BQWY7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPLE9BQU8sQ0FBQyxxQkFBZjtBQUNEO0FBQ0Y7O0FBRUQsU0FBUyxtQkFBVCxHQUNvQztBQUFBLE1BQWxDLE9BQWtDLHVFQUFGLEVBQUU7O0FBRWxDLE1BQUksT0FBTyxDQUFDLG1CQUFSLEtBQWdDLFNBQXBDLEVBQStDO0FBQzdDLFdBQU8sT0FBTyxDQUFDLE9BQWY7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPLE9BQU8sQ0FBQyxtQkFBZjtBQUNEO0FBQ0Y7O0FBRUQsU0FBUyxVQUFULENBQ0UsT0FERixFQUVFLEtBRkYsRUFFVTtBQUVSLE1BQUksT0FBSixFQUFhO0FBQ1gsUUFBSSxPQUFPLENBQUMsS0FBRCxDQUFQLEtBQW1CLFNBQXZCLEVBQWtDO0FBQ2hDLGFBQU8sT0FBTyxDQUFDLEtBQUQsQ0FBZDtBQUNEO0FBQ0Y7O0FBQ0QsU0FBTyxlQUFlLENBQUMsS0FBRCxDQUF0QjtBQUNEOztBQUVELFNBQVMsdUJBQVQsQ0FBaUMsS0FBakMsRUFBNkMsWUFBN0MsRUFBaUU7QUFFL0QsTUFBSSxnQkFBZ0IsS0FBaEIsSUFBeUIsa0JBQWtCLEtBQS9DLEVBQXNEO0FBQ3BELFdBQU87QUFBRSxNQUFBLElBQUksRUFBRSxLQUFLLENBQUMsVUFBZDtBQUEwQixNQUFBLE1BQU0sRUFBRSxLQUFLLENBQUM7QUFBeEMsS0FBUDtBQUNEOztBQUVELE1BQU0sS0FBSyxHQUFHLG9CQUFvQixJQUFwQixDQUF5QixLQUFLLENBQUMsT0FBL0IsQ0FBZDs7QUFDQSxNQUFJLEtBQUosRUFBVztBQUNULFFBQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBRCxDQUFOLEVBQVcsRUFBWCxDQUF0QjtBQUNBLFFBQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxLQUFiLENBQW1CLENBQW5CLEVBQXNCLEtBQUssR0FBRyxDQUE5QixFQUFpQyxLQUFqQyxDQUF1QyxJQUF2QyxDQUFkO0FBQ0EsV0FBTztBQUFFLE1BQUEsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFkO0FBQXNCLE1BQUEsTUFBTSxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTixHQUFlLENBQWhCLENBQUwsQ0FBd0I7QUFBdEQsS0FBUDtBQUNEOztBQUVELFNBQU8sSUFBUDtBQUNEOztBQUVELFNBQVMscUJBQVQsQ0FBK0IsSUFBL0IsRUFBOEMsSUFBOUMsRUFBMkQ7QUFDekQsTUFBSSxDQUFBLElBQUksS0FBQSxJQUFKLElBQUEsSUFBSSxLQUFBLEtBQUEsQ0FBSixHQUFJLEtBQUEsQ0FBSixHQUFBLElBQUksQ0FBRSxJQUFOLEVBQUEsTUFBaUIsRUFBckIsRUFBeUI7QUFDdkIsVUFBTSxJQUFJLGVBQUEsQ0FBQSxrQkFBSixDQUF1QixJQUF2QixDQUFOO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvZGVGcmFtZUNvbHVtbnMgfSBmcm9tICdAYmFiZWwvY29kZS1mcmFtZSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IEpTT041IGZyb20gJ2pzb241JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5pbXBvcnQgd3JpdGVGaWxlQXRvbWljIGZyb20gJ3dyaXRlLWZpbGUtYXRvbWljJztcblxuaW1wb3J0IEpzb25GaWxlRXJyb3IsIHsgRW1wdHlKc29uRmlsZUVycm9yIH0gZnJvbSAnLi9Kc29uRmlsZUVycm9yJztcblxuY29uc3Qgd3JpdGVGaWxlQXRvbWljQXN5bmM6IChcbiAgZmlsZW5hbWU6IHN0cmluZyxcbiAgZGF0YTogc3RyaW5nIHwgQnVmZmVyLFxuICBvcHRpb25zOiB3cml0ZUZpbGVBdG9taWMuT3B0aW9uc1xuKSA9PiB2b2lkID0gcHJvbWlzaWZ5KHdyaXRlRmlsZUF0b21pYyk7XG5cbmV4cG9ydCB0eXBlIEpTT05WYWx1ZSA9IGJvb2xlYW4gfCBudW1iZXIgfCBzdHJpbmcgfCBudWxsIHwgSlNPTkFycmF5IHwgSlNPTk9iamVjdDtcbmV4cG9ydCBpbnRlcmZhY2UgSlNPTkFycmF5IGV4dGVuZHMgQXJyYXk8SlNPTlZhbHVlPiB7fVxuZXhwb3J0IGludGVyZmFjZSBKU09OT2JqZWN0IHtcbiAgW2tleTogc3RyaW5nXTogSlNPTlZhbHVlIHwgdW5kZWZpbmVkO1xufVxuXG50eXBlIERlZmluZWQ8VD4gPSBUIGV4dGVuZHMgdW5kZWZpbmVkID8gbmV2ZXIgOiBUO1xuXG50eXBlIE9wdGlvbnM8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PiA9IHtcbiAgYmFkSnNvbkRlZmF1bHQ/OiBUSlNPTk9iamVjdDtcbiAganNvblBhcnNlRXJyb3JEZWZhdWx0PzogVEpTT05PYmplY3Q7XG4gIGNhbnRSZWFkRmlsZURlZmF1bHQ/OiBUSlNPTk9iamVjdDtcbiAgZW5zdXJlRGlyPzogYm9vbGVhbjtcbiAgZGVmYXVsdD86IFRKU09OT2JqZWN0O1xuICBqc29uNT86IGJvb2xlYW47XG4gIHNwYWNlPzogbnVtYmVyO1xuICBhZGROZXdMaW5lQXRFT0Y/OiBib29sZWFuO1xufTtcblxuY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xuICBiYWRKc29uRGVmYXVsdDogdW5kZWZpbmVkLFxuICBqc29uUGFyc2VFcnJvckRlZmF1bHQ6IHVuZGVmaW5lZCxcbiAgY2FudFJlYWRGaWxlRGVmYXVsdDogdW5kZWZpbmVkLFxuICBlbnN1cmVEaXI6IGZhbHNlLFxuICBkZWZhdWx0OiB1bmRlZmluZWQsXG4gIGpzb241OiBmYWxzZSxcbiAgc3BhY2U6IDIsXG4gIGFkZE5ld0xpbmVBdEVPRjogdHJ1ZSxcbn07XG5cbi8qKlxuICogVGhlIEpzb25GaWxlIGNsYXNzIHJlcHJlc2VudHMgdGhlIGNvbnRlbnRzIG9mIGpzb24gZmlsZS5cbiAqXG4gKiBJdCdzIHBvbHltb3JwaGljIG9uIFwiSlNPTk9iamVjdFwiLCB3aGljaCBpcyBhIHNpbXBsZSB0eXBlIHJlcHJlc2VudGluZ1xuICogYW5kIG9iamVjdCB3aXRoIHN0cmluZyBrZXlzIGFuZCBlaXRoZXIgb2JqZWN0cyBvciBwcmltaXRpdmUgdHlwZXMgYXMgdmFsdWVzLlxuICogQHR5cGUge1t0eXBlXX1cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSnNvbkZpbGU8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PiB7XG4gIGZpbGU6IHN0cmluZztcbiAgb3B0aW9uczogT3B0aW9uczxUSlNPTk9iamVjdD47XG5cbiAgc3RhdGljIHJlYWQgPSByZWFkO1xuICBzdGF0aWMgcmVhZEFzeW5jID0gcmVhZEFzeW5jO1xuICBzdGF0aWMgcGFyc2VKc29uU3RyaW5nID0gcGFyc2VKc29uU3RyaW5nO1xuICBzdGF0aWMgd3JpdGVBc3luYyA9IHdyaXRlQXN5bmM7XG4gIHN0YXRpYyBnZXRBc3luYyA9IGdldEFzeW5jO1xuICBzdGF0aWMgc2V0QXN5bmMgPSBzZXRBc3luYztcbiAgc3RhdGljIG1lcmdlQXN5bmMgPSBtZXJnZUFzeW5jO1xuICBzdGF0aWMgZGVsZXRlS2V5QXN5bmMgPSBkZWxldGVLZXlBc3luYztcbiAgc3RhdGljIGRlbGV0ZUtleXNBc3luYyA9IGRlbGV0ZUtleXNBc3luYztcbiAgc3RhdGljIHJld3JpdGVBc3luYyA9IHJld3JpdGVBc3luYztcblxuICBjb25zdHJ1Y3RvcihmaWxlOiBzdHJpbmcsIG9wdGlvbnM6IE9wdGlvbnM8VEpTT05PYmplY3Q+ID0ge30pIHtcbiAgICB0aGlzLmZpbGUgPSBmaWxlO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICByZWFkKG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pik6IFRKU09OT2JqZWN0IHtcbiAgICByZXR1cm4gcmVhZCh0aGlzLmZpbGUsIHRoaXMuX2dldE9wdGlvbnMob3B0aW9ucykpO1xuICB9XG5cbiAgYXN5bmMgcmVhZEFzeW5jKG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pik6IFByb21pc2U8VEpTT05PYmplY3Q+IHtcbiAgICByZXR1cm4gcmVhZEFzeW5jKHRoaXMuZmlsZSwgdGhpcy5fZ2V0T3B0aW9ucyhvcHRpb25zKSk7XG4gIH1cblxuICBhc3luYyB3cml0ZUFzeW5jKG9iamVjdDogVEpTT05PYmplY3QsIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pikge1xuICAgIHJldHVybiB3cml0ZUFzeW5jKHRoaXMuZmlsZSwgb2JqZWN0LCB0aGlzLl9nZXRPcHRpb25zKG9wdGlvbnMpKTtcbiAgfVxuXG4gIHBhcnNlSnNvblN0cmluZyhqc29uOiBzdHJpbmcsIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pik6IFRKU09OT2JqZWN0IHtcbiAgICByZXR1cm4gcGFyc2VKc29uU3RyaW5nKGpzb24sIG9wdGlvbnMpO1xuICB9XG5cbiAgYXN5bmMgZ2V0QXN5bmM8SyBleHRlbmRzIGtleW9mIFRKU09OT2JqZWN0LCBURGVmYXVsdCBleHRlbmRzIFRKU09OT2JqZWN0W0tdIHwgbnVsbD4oXG4gICAga2V5OiBLLFxuICAgIGRlZmF1bHRWYWx1ZTogVERlZmF1bHQsXG4gICAgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+XG4gICk6IFByb21pc2U8RGVmaW5lZDxUSlNPTk9iamVjdFtLXT4gfCBURGVmYXVsdD4ge1xuICAgIHJldHVybiBnZXRBc3luYyh0aGlzLmZpbGUsIGtleSwgZGVmYXVsdFZhbHVlLCB0aGlzLl9nZXRPcHRpb25zKG9wdGlvbnMpKTtcbiAgfVxuXG4gIGFzeW5jIHNldEFzeW5jKGtleTogc3RyaW5nLCB2YWx1ZTogdW5rbm93biwgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+KSB7XG4gICAgcmV0dXJuIHNldEFzeW5jKHRoaXMuZmlsZSwga2V5LCB2YWx1ZSwgdGhpcy5fZ2V0T3B0aW9ucyhvcHRpb25zKSk7XG4gIH1cblxuICBhc3luYyBtZXJnZUFzeW5jKFxuICAgIHNvdXJjZXM6IFBhcnRpYWw8VEpTT05PYmplY3Q+IHwgUGFydGlhbDxUSlNPTk9iamVjdD5bXSxcbiAgICBvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD5cbiAgKTogUHJvbWlzZTxUSlNPTk9iamVjdD4ge1xuICAgIHJldHVybiBtZXJnZUFzeW5jPFRKU09OT2JqZWN0Pih0aGlzLmZpbGUsIHNvdXJjZXMsIHRoaXMuX2dldE9wdGlvbnMob3B0aW9ucykpO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlS2V5QXN5bmMoa2V5OiBzdHJpbmcsIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pikge1xuICAgIHJldHVybiBkZWxldGVLZXlBc3luYyh0aGlzLmZpbGUsIGtleSwgdGhpcy5fZ2V0T3B0aW9ucyhvcHRpb25zKSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVLZXlzQXN5bmMoa2V5czogc3RyaW5nW10sIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0Pikge1xuICAgIHJldHVybiBkZWxldGVLZXlzQXN5bmModGhpcy5maWxlLCBrZXlzLCB0aGlzLl9nZXRPcHRpb25zKG9wdGlvbnMpKTtcbiAgfVxuXG4gIGFzeW5jIHJld3JpdGVBc3luYyhvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD4pIHtcbiAgICByZXR1cm4gcmV3cml0ZUFzeW5jKHRoaXMuZmlsZSwgdGhpcy5fZ2V0T3B0aW9ucyhvcHRpb25zKSk7XG4gIH1cblxuICBfZ2V0T3B0aW9ucyhvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD4pOiBPcHRpb25zPFRKU09OT2JqZWN0PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZWFkPFRKU09OT2JqZWN0IGV4dGVuZHMgSlNPTk9iamVjdD4oXG4gIGZpbGU6IHN0cmluZyxcbiAgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+XG4pOiBUSlNPTk9iamVjdCB7XG4gIGxldCBqc29uO1xuICB0cnkge1xuICAgIGpzb24gPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBhc3NlcnRFbXB0eUpzb25TdHJpbmcoanNvbiwgZmlsZSk7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gY2FudFJlYWRGaWxlRGVmYXVsdChvcHRpb25zKTtcbiAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBKc29uRmlsZUVycm9yKGBDYW4ndCByZWFkIEpTT04gZmlsZTogJHtmaWxlfWAsIGVycm9yLCBlcnJvci5jb2RlLCBmaWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHBhcnNlSnNvblN0cmluZyhqc29uLCBvcHRpb25zLCBmaWxlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVhZEFzeW5jPFRKU09OT2JqZWN0IGV4dGVuZHMgSlNPTk9iamVjdD4oXG4gIGZpbGU6IHN0cmluZyxcbiAgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+XG4pOiBQcm9taXNlPFRKU09OT2JqZWN0PiB7XG4gIGxldCBqc29uO1xuICB0cnkge1xuICAgIGpzb24gPSBhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZShmaWxlLCAndXRmOCcpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGFzc2VydEVtcHR5SnNvblN0cmluZyhqc29uLCBmaWxlKTtcbiAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBjYW50UmVhZEZpbGVEZWZhdWx0KG9wdGlvbnMpO1xuICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEpzb25GaWxlRXJyb3IoYENhbid0IHJlYWQgSlNPTiBmaWxlOiAke2ZpbGV9YCwgZXJyb3IsIGVycm9yLmNvZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGFyc2VKc29uU3RyaW5nKGpzb24sIG9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBwYXJzZUpzb25TdHJpbmc8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAganNvbjogc3RyaW5nLFxuICBvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD4sXG4gIGZpbGVOYW1lPzogc3RyaW5nXG4pOiBUSlNPTk9iamVjdCB7XG4gIGFzc2VydEVtcHR5SnNvblN0cmluZyhqc29uLCBmaWxlTmFtZSk7XG4gIHRyeSB7XG4gICAgaWYgKF9nZXRPcHRpb24ob3B0aW9ucywgJ2pzb241JykpIHtcbiAgICAgIHJldHVybiBKU09ONS5wYXJzZShqc29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0ganNvblBhcnNlRXJyb3JEZWZhdWx0KG9wdGlvbnMpO1xuICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc3QgbG9jYXRpb24gPSBsb2NhdGlvbkZyb21TeW50YXhFcnJvcihlLCBqc29uKTtcbiAgICAgIGlmIChsb2NhdGlvbikge1xuICAgICAgICBjb25zdCBjb2RlRnJhbWUgPSBjb2RlRnJhbWVDb2x1bW5zKGpzb24sIHsgc3RhcnQ6IGxvY2F0aW9uIH0pO1xuICAgICAgICBlLmNvZGVGcmFtZSA9IGNvZGVGcmFtZTtcbiAgICAgICAgZS5tZXNzYWdlICs9IGBcXG4ke2NvZGVGcmFtZX1gO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEpzb25GaWxlRXJyb3IoYEVycm9yIHBhcnNpbmcgSlNPTjogJHtqc29ufWAsIGUsICdFSlNPTlBBUlNFJywgZmlsZU5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBc3luYzxUSlNPTk9iamVjdCBleHRlbmRzIEpTT05PYmplY3QsIEsgZXh0ZW5kcyBrZXlvZiBUSlNPTk9iamVjdCwgRGVmYXVsdFZhbHVlPihcbiAgZmlsZTogc3RyaW5nLFxuICBrZXk6IEssXG4gIGRlZmF1bHRWYWx1ZTogRGVmYXVsdFZhbHVlLFxuICBvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD5cbik6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IG9iamVjdCA9IGF3YWl0IHJlYWRBc3luYyhmaWxlLCBvcHRpb25zKTtcbiAgaWYgKGtleSBpbiBvYmplY3QpIHtcbiAgICByZXR1cm4gb2JqZWN0W2tleV07XG4gIH1cbiAgaWYgKGRlZmF1bHRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEpzb25GaWxlRXJyb3IoYE5vIHZhbHVlIGF0IGtleSBwYXRoIFwiJHtrZXl9XCIgaW4gSlNPTiBvYmplY3QgZnJvbTogJHtmaWxlfWApO1xuICB9XG4gIHJldHVybiBkZWZhdWx0VmFsdWU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXN5bmM8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAgZmlsZTogc3RyaW5nLFxuICBvYmplY3Q6IFRKU09OT2JqZWN0LFxuICBvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD5cbik6IFByb21pc2U8VEpTT05PYmplY3Q+IHtcbiAgaWYgKG9wdGlvbnM/LmVuc3VyZURpcikge1xuICAgIGF3YWl0IGZzLnByb21pc2VzLm1rZGlyKHBhdGguZGlybmFtZShmaWxlKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIH1cbiAgY29uc3Qgc3BhY2UgPSBfZ2V0T3B0aW9uKG9wdGlvbnMsICdzcGFjZScpO1xuICBjb25zdCBqc29uNSA9IF9nZXRPcHRpb24ob3B0aW9ucywgJ2pzb241Jyk7XG4gIGNvbnN0IGFkZE5ld0xpbmVBdEVPRiA9IF9nZXRPcHRpb24ob3B0aW9ucywgJ2FkZE5ld0xpbmVBdEVPRicpO1xuICBsZXQganNvbjtcbiAgdHJ5IHtcbiAgICBpZiAoanNvbjUpIHtcbiAgICAgIGpzb24gPSBKU09ONS5zdHJpbmdpZnkob2JqZWN0LCBudWxsLCBzcGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGpzb24gPSBKU09OLnN0cmluZ2lmeShvYmplY3QsIG51bGwsIHNwYWNlKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgSnNvbkZpbGVFcnJvcihgQ291bGRuJ3QgSlNPTi5zdHJpbmdpZnkgb2JqZWN0IGZvciBmaWxlOiAke2ZpbGV9YCwgZSk7XG4gIH1cbiAgY29uc3QgZGF0YSA9IGFkZE5ld0xpbmVBdEVPRiA/IGAke2pzb259XFxuYCA6IGpzb247XG4gIGF3YWl0IHdyaXRlRmlsZUF0b21pY0FzeW5jKGZpbGUsIGRhdGEsIHt9KTtcbiAgcmV0dXJuIG9iamVjdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0QXN5bmM8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAgZmlsZTogc3RyaW5nLFxuICBrZXk6IHN0cmluZyxcbiAgdmFsdWU6IHVua25vd24sXG4gIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0PlxuKTogUHJvbWlzZTxUSlNPTk9iamVjdD4ge1xuICAvLyBUT0RPOiBDb25zaWRlciBpbXBsZW1lbnRpbmcgc29tZSBraW5kIG9mIGxvY2tpbmcgbWVjaGFuaXNtLCBidXRcbiAgLy8gaXQncyBub3QgY3JpdGljYWwgZm9yIG91ciB1c2UgY2FzZSwgc28gd2UnbGwgbGVhdmUgaXQgb3V0IGZvciBub3dcbiAgY29uc3Qgb2JqZWN0ID0gYXdhaXQgcmVhZEFzeW5jKGZpbGUsIG9wdGlvbnMpO1xuICByZXR1cm4gd3JpdGVBc3luYyhmaWxlLCB7IC4uLm9iamVjdCwgW2tleV06IHZhbHVlIH0sIG9wdGlvbnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBtZXJnZUFzeW5jPFRKU09OT2JqZWN0IGV4dGVuZHMgSlNPTk9iamVjdD4oXG4gIGZpbGU6IHN0cmluZyxcbiAgc291cmNlczogUGFydGlhbDxUSlNPTk9iamVjdD4gfCBQYXJ0aWFsPFRKU09OT2JqZWN0PltdLFxuICBvcHRpb25zPzogT3B0aW9uczxUSlNPTk9iamVjdD5cbik6IFByb21pc2U8VEpTT05PYmplY3Q+IHtcbiAgY29uc3Qgb2JqZWN0ID0gYXdhaXQgcmVhZEFzeW5jKGZpbGUsIG9wdGlvbnMpO1xuICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VzKSkge1xuICAgIE9iamVjdC5hc3NpZ24ob2JqZWN0LCAuLi5zb3VyY2VzKTtcbiAgfSBlbHNlIHtcbiAgICBPYmplY3QuYXNzaWduKG9iamVjdCwgc291cmNlcyk7XG4gIH1cbiAgcmV0dXJuIHdyaXRlQXN5bmMoZmlsZSwgb2JqZWN0LCBvcHRpb25zKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlS2V5QXN5bmM8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAgZmlsZTogc3RyaW5nLFxuICBrZXk6IHN0cmluZyxcbiAgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+XG4pOiBQcm9taXNlPFRKU09OT2JqZWN0PiB7XG4gIHJldHVybiBkZWxldGVLZXlzQXN5bmMoZmlsZSwgW2tleV0sIG9wdGlvbnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVLZXlzQXN5bmM8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAgZmlsZTogc3RyaW5nLFxuICBrZXlzOiBzdHJpbmdbXSxcbiAgb3B0aW9ucz86IE9wdGlvbnM8VEpTT05PYmplY3Q+XG4pOiBQcm9taXNlPFRKU09OT2JqZWN0PiB7XG4gIGNvbnN0IG9iamVjdCA9IGF3YWl0IHJlYWRBc3luYyhmaWxlLCBvcHRpb25zKTtcbiAgbGV0IGRpZERlbGV0ZSA9IGZhbHNlO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBkZWxldGUgb2JqZWN0W2tleV07XG4gICAgICBkaWREZWxldGUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkaWREZWxldGUpIHtcbiAgICByZXR1cm4gd3JpdGVBc3luYyhmaWxlLCBvYmplY3QsIG9wdGlvbnMpO1xuICB9XG4gIHJldHVybiBvYmplY3Q7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJld3JpdGVBc3luYzxUSlNPTk9iamVjdCBleHRlbmRzIEpTT05PYmplY3Q+KFxuICBmaWxlOiBzdHJpbmcsXG4gIG9wdGlvbnM/OiBPcHRpb25zPFRKU09OT2JqZWN0PlxuKTogUHJvbWlzZTxUSlNPTk9iamVjdD4ge1xuICBjb25zdCBvYmplY3QgPSBhd2FpdCByZWFkQXN5bmMoZmlsZSwgb3B0aW9ucyk7XG4gIHJldHVybiB3cml0ZUFzeW5jKGZpbGUsIG9iamVjdCwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGpzb25QYXJzZUVycm9yRGVmYXVsdDxUSlNPTk9iamVjdCBleHRlbmRzIEpTT05PYmplY3Q+KFxuICBvcHRpb25zOiBPcHRpb25zPFRKU09OT2JqZWN0PiA9IHt9XG4pOiBUSlNPTk9iamVjdCB8IHZvaWQge1xuICBpZiAob3B0aW9ucy5qc29uUGFyc2VFcnJvckRlZmF1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBvcHRpb25zLmRlZmF1bHQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG9wdGlvbnMuanNvblBhcnNlRXJyb3JEZWZhdWx0O1xuICB9XG59XG5cbmZ1bmN0aW9uIGNhbnRSZWFkRmlsZURlZmF1bHQ8VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0PihcbiAgb3B0aW9uczogT3B0aW9uczxUSlNPTk9iamVjdD4gPSB7fVxuKTogVEpTT05PYmplY3QgfCB2b2lkIHtcbiAgaWYgKG9wdGlvbnMuY2FudFJlYWRGaWxlRGVmYXVsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIG9wdGlvbnMuZGVmYXVsdDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gb3B0aW9ucy5jYW50UmVhZEZpbGVEZWZhdWx0O1xuICB9XG59XG5cbmZ1bmN0aW9uIF9nZXRPcHRpb248VEpTT05PYmplY3QgZXh0ZW5kcyBKU09OT2JqZWN0LCBLIGV4dGVuZHMga2V5b2YgT3B0aW9uczxUSlNPTk9iamVjdD4+KFxuICBvcHRpb25zOiBPcHRpb25zPFRKU09OT2JqZWN0PiB8IHVuZGVmaW5lZCxcbiAgZmllbGQ6IEtcbik6IE9wdGlvbnM8VEpTT05PYmplY3Q+W0tdIHtcbiAgaWYgKG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9uc1tmaWVsZF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG9wdGlvbnNbZmllbGRdO1xuICAgIH1cbiAgfVxuICByZXR1cm4gREVGQVVMVF9PUFRJT05TW2ZpZWxkXTtcbn1cblxuZnVuY3Rpb24gbG9jYXRpb25Gcm9tU3ludGF4RXJyb3IoZXJyb3I6IGFueSwgc291cmNlU3RyaW5nOiBzdHJpbmcpIHtcbiAgLy8gSlNPTjUgU3ludGF4RXJyb3IgaGFzIGxpbmVOdW1iZXIgYW5kIGNvbHVtbk51bWJlci5cbiAgaWYgKCdsaW5lTnVtYmVyJyBpbiBlcnJvciAmJiAnY29sdW1uTnVtYmVyJyBpbiBlcnJvcikge1xuICAgIHJldHVybiB7IGxpbmU6IGVycm9yLmxpbmVOdW1iZXIsIGNvbHVtbjogZXJyb3IuY29sdW1uTnVtYmVyIH07XG4gIH1cbiAgLy8gSlNPTiBTeW50YXhFcnJvciBvbmx5IGluY2x1ZGVzIHRoZSBpbmRleCBpbiB0aGUgbWVzc2FnZS5cbiAgY29uc3QgbWF0Y2ggPSAvYXQgcG9zaXRpb24gKFxcZCspLy5leGVjKGVycm9yLm1lc3NhZ2UpO1xuICBpZiAobWF0Y2gpIHtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KG1hdGNoWzFdLCAxMCk7XG4gICAgY29uc3QgbGluZXMgPSBzb3VyY2VTdHJpbmcuc2xpY2UoMCwgaW5kZXggKyAxKS5zcGxpdCgnXFxuJyk7XG4gICAgcmV0dXJuIHsgbGluZTogbGluZXMubGVuZ3RoLCBjb2x1bW46IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLmxlbmd0aCB9O1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGFzc2VydEVtcHR5SnNvblN0cmluZyhqc29uPzogc3RyaW5nLCBmaWxlPzogc3RyaW5nKSB7XG4gIGlmIChqc29uPy50cmltKCkgPT09ICcnKSB7XG4gICAgdGhyb3cgbmV3IEVtcHR5SnNvbkZpbGVFcnJvcihmaWxlKTtcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==